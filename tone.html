<html>
<head>
<script src="static/js/jquery.min.js"></script> 
<script src="tone.js"></script> 
<script src="mbira-tone.js"></script>
<script> 
$(function () {
    var TAG = 'Page'
    DEBUG = true
    
    var mbiraTone = null    
    
    var onMbiraStartClicked = function () {
        log(TAG+': onMbiraStartClicked')
        if (mbiraTone) mbiraTone.start()
        $('#mbira-start').prop('disabled', true);
        $('#mbira-stop').prop('disabled', false);
    }
    var onMbiraStopClicked = function () {
        log(TAG+': onMbiraStopClicked')
        if (mbiraTone) mbiraTone.stop()
        $('#mbira-start').prop('disabled', false);
        $('#mbira-stop').prop('disabled', true);
    }
    var onMbiraLoadClicked = function () {
        log(TAG+': onMbiraLoadClicked')
        onMbiraStopClicked()
        onMbiraLoading()
        if (mbiraTone) mbiraTone.load({
            kit: 'dambatsoko_e', 
            tab:'nyamaropa_kushaura',
            tempo: '8n',
            onKeysPlayed: onKeysPlayed
        }, function(){
            onMbiraLoaded()
        })
    }
    var onMbiraLoading = function () {
        log(TAG+': onMbiraLoading')
        $('#mbira-start').prop('disabled', true);
        $('#mbira-stop').prop('disabled', true);
        $('#mbira-load').prop('disabled', true);
    }
    var onMbiraLoaded = function () {
        log(TAG+': onMbiraLoaded')
        $('#mbira-start').prop('disabled', false);
        $('#mbira-load').prop('disabled', true);
    }
    var onPageLoad = function () {
        mbiraTone = MbiraTone(window) // load this first
        log(TAG+': onPageLoad')
        $('#mbira-load').prop('disabled', false);     
        $('#mbira-load').on('click', function(ev){ onMbiraLoadClicked() })
        $('#mbira-start').on('click', function(ev){ onMbiraStartClicked() })
        $('#mbira-stop').on('click', function(ev){ onMbiraStopClicked() })
    }
    var onKeysPlayed = function(keys) {
        log(TAG+': onKeysPlayed: keys='+keys)
        $('#mbira-now-playing').text(keys)
    }
    onPageLoad()
})
</script>
</head>
<body>
    <input id='mbira-load' type='submit' value='Load' disabled='disabled'/>
    <input id='mbira-start' type='submit' value='Start' disabled='disabled'/>
    <input id='mbira-stop' type='submit' value='Stop' disabled='disabled'/>
    <div id='mbira-now-playing'></div>
</body>
</html>